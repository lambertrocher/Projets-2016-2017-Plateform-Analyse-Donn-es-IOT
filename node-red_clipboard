[{"id":"cde7ed36.5f18c","type":"tab","label":"Flow 1"},{"id":"73218b9.5af8a74","type":"subflow","name":"Iterate","info":"","in":[{"x":220,"y":219,"wires":[{"id":"cfa33ed6.a03eb"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"cfa33ed6.a03eb","port":0}]},{"x":455,"y":259,"wires":[{"id":"cfa33ed6.a03eb","port":1}]}]},{"id":"8bfe3e12.6a69","type":"influxdb","z":"","hostname":"bd","port":"8086","protocol":"http","database":"mydb","name":"","usetls":false,"tls":""},{"id":"cfa33ed6.a03eb","type":"function","z":"73218b9.5af8a74","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n //Make sure payload is an array\n if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n msg.payload = [msg.payload];\n }\n\n msg.iterationInfo = itt = {};\n itt.index = -1;\n itt.inArray = msg.payload;\n itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n nextObj = msg;\n msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n out = msg;\n msg.payload = itt.outArray;\n delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":341,"y":216,"wires":[[],[]]},{"id":"3cb1aec4.a0c28a","type":"http request","z":"cde7ed36.5f18c","name":"show grafana sources","method":"GET","ret":"txt","url":"visualisation:3000/api/datasources","tls":"","x":391.0994110107422,"y":174.48009490966797,"wires":[["94d76f1b.9c438"]]},{"id":"94d76f1b.9c438","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"false","x":625.991096496582,"y":160.8888759613037,"wires":[]},{"id":"b7c23fa7.aa0f","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":175.9939956665039,"y":182.43086528778076,"wires":[["3cb1aec4.a0c28a"]]},{"id":"767c7246.28f5ac","type":"http request","z":"cde7ed36.5f18c","name":"show grafana sources (second method)","method":"GET","ret":"txt","url":"172.17.0.1:32774/api/datasources","tls":"","x":439.5438766479492,"y":266.2020435333252,"wires":[["dde7026b.cb388"]]},{"id":"dde7026b.cb388","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"false","x":719.546688079834,"y":256.4996814727783,"wires":[]},{"id":"88fef4ff.7be47","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":178.88288116455078,"y":273.81948471069336,"wires":[["767c7246.28f5ac"]]},{"id":"88be1a33.3c03b8","type":"http request","z":"cde7ed36.5f18c","name":"ping the database","method":"GET","ret":"txt","url":"bd:8086/ping","tls":"","x":386.8607711791992,"y":386.09596157073975,"wires":[["e4707a2f.5257b","316046f.31955ba"]]},{"id":"86403d4b.86a718","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":185.0915412902832,"y":400.53282165527344,"wires":[["88be1a33.3c03b8"]]},{"id":"e4707a2f.5257b","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"payload","x":597.3137245178223,"y":363.9737949371338,"wires":[]},{"id":"316046f.31955ba","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"headers","x":593.9803657531738,"y":410.75157928466797,"wires":[]},{"id":"11b2e5cf.28397a","type":"http request","z":"cde7ed36.5f18c","name":"create database","method":"POST","ret":"txt","url":"bd:8086/query","tls":"","x":592.9881935119629,"y":522.4569883346558,"wires":[["52a97196.2dedd8","e4a09a92.a73bf8"]]},{"id":"c2378594.fa9ed8","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":128.46910095214844,"y":545.1995544433594,"wires":[["c4de6d3c.71f78"]]},{"id":"52a97196.2dedd8","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"payload","x":800.6634941101074,"y":507.140513420105,"wires":[]},{"id":"e4a09a92.a73bf8","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"headers","x":797.3300933837891,"y":552.8072156906128,"wires":[]},{"id":"c4de6d3c.71f78","type":"function","z":"cde7ed36.5f18c","name":"set parameters of the request","func":"msg.payload = {q:'CREATE DATABASE \"mydb\"'};\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":353.7610321044922,"y":536.7074708938599,"wires":[["11b2e5cf.28397a"]]},{"id":"136e0cdc.c6f4cb","type":"influxdb in","z":"cde7ed36.5f18c","influxdb":"8bfe3e12.6a69","name":"create db (method 2)","query":"CREATE DATABASE \"mydb2\"","x":397.32598876953125,"y":621.2996711730957,"wires":[["6cc9416d.51de3","c702e08a.7437c8"]]},{"id":"6cc9416d.51de3","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"false","x":618.5830459594727,"y":606.6121702194214,"wires":[]},{"id":"c702e08a.7437c8","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"headers","x":616.0759658813477,"y":656.6050910949707,"wires":[]},{"id":"92fd0f24.3c6b98","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":168.57598876953125,"y":630.0851936340332,"wires":[["136e0cdc.c6f4cb"]]},{"id":"1174079f.813e7","type":"influxdb in","z":"cde7ed36.5f18c","influxdb":"8bfe3e12.6a69","name":"show databases","query":"SHOW DATABASES","x":390,"y":734.54541015625,"wires":[["cdd225b0.6df2f8","6e40b926.571a7"]]},{"id":"cdd225b0.6df2f8","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"false","x":631.2570571899414,"y":719.8579092025757,"wires":[]},{"id":"6e40b926.571a7","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"headers","x":628.7499771118164,"y":769.850830078125,"wires":[]},{"id":"1af71a54.fcfb26","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":181.25,"y":743.3309326171875,"wires":[["1174079f.813e7"]]},{"id":"fe26500e.8b7c5","type":"function","z":"cde7ed36.5f18c","name":"2messages","func":"var msg1 = { payload:\"CREATE DATABASE mydb5\" };\nvar msg2 = { payload:\"CREATE DATABASE mydb6\" };\nreturn [[msg1, msg2]];","outputs":1,"noerr":0,"x":250.7222137451172,"y":949.3610939979553,"wires":[["d97c716d.bd88a8"]]},{"id":"bd65feee.25cda","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":113.61111450195312,"y":874.3055429458618,"wires":[["fe26500e.8b7c5"]]},{"id":"36b67637.b9b932","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"payload","x":710,"y":882,"wires":[]},{"id":"f319192c.d6ff98","type":"influxdb in","z":"cde7ed36.5f18c","influxdb":"8bfe3e12.6a69","name":"create db (method 2)","query":"","x":540.3333358764648,"y":945.222246170044,"wires":[["36b67637.b9b932"]]},{"id":"d97c716d.bd88a8","type":"function","z":"cde7ed36.5f18c","name":"set query","func":"msg.query=msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":392.2222328186035,"y":872.2222690582275,"wires":[["f319192c.d6ff98"]]},{"id":"9cb01f02.a2357","type":"function","z":"cde7ed36.5f18c","name":"inject json","func":"var msg = {payload:[\n {\n \"id\": 2308,\n \"address\": \"1/1/4\",\n \"data\": 176,\n \"datatype\": 14,\n \"date\": \"Sun, 25 Dec 2016 20:46:04 +0100\",\n \"comment\": \"\",\n \"name\": \"Puissance générale\",\n \"time\": 1482695164\n },\n {\n \"id\": 2309,\n \"address\": \"1/1/5\",\n \"data\": 1448061,\n \"datatype\": 14,\n \"date\": \"Sun, 25 Dec 2016 20:45:59 +0100\",\n \"comment\": \"\",\n \"name\": \"Energie générale\",\n \"time\": 1482695159\n }]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":289.3333435058594,"y":1330.3330078125,"wires":[["ce8f987f.adc31","329cd338.e64d84"]]},{"id":"cad29ab.60cbc68","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":123.33334350585938,"y":1115.5555438995361,"wires":[["ac0f8f2d.9be07"]]},{"id":"2f5ac62f.2c1fda","type":"split","z":"cde7ed36.5f18c","name":"","splt":"\\n","x":448.33335876464844,"y":1098.8888673782349,"wires":[["2bb7fe19.1aa282"]]},{"id":"8d3a44da.eed908","type":"http request","z":"cde7ed36.5f18c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":638.5,"y":1238,"wires":[["ab2fa168.dedf2"]]},{"id":"2bb7fe19.1aa282","type":"function","z":"cde7ed36.5f18c","name":"Get address","func":"var msg = { payload : msg.payload.address};\nreturn msg;","outputs":1,"noerr":0,"x":601.5,"y":1066,"wires":[["8167110c.e6136"]]},{"id":"5e0b5e3b.01bdd","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"url","x":795.5,"y":1130,"wires":[]},{"id":"8167110c.e6136","type":"function","z":"cde7ed36.5f18c","name":"Get URL","func":"msg.url = \"http://remote:remote@10.0.2.3/scada-remote?m=json&r=grp&fn=find&alias=\"+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":593.5,"y":1153,"wires":[["8d3a44da.eed908","5e0b5e3b.01bdd"]]},{"id":"ac0f8f2d.9be07","type":"http request","z":"cde7ed36.5f18c","name":"","method":"GET","ret":"txt","url":"http://remote:remote@10.0.2.3/scada-remote?m=json&r=objects","tls":"","x":293.5,"y":1124,"wires":[["2f5ac62f.2c1fda"]]},{"id":"ab2fa168.dedf2","type":"file","z":"cde7ed36.5f18c","name":"","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","x":823.5,"y":1231,"wires":[]},{"id":"bb056562.a74f48","type":"inject","z":"cde7ed36.5f18c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":127.5,"y":1325,"wires":[["9cb01f02.a2357"]]},{"id":"ce8f987f.adc31","type":"file","z":"cde7ed36.5f18c","name":"","filename":"node-red/test","appendNewline":true,"createDir":false,"overwriteFile":"false","x":485.5,"y":1326,"wires":[]},{"id":"329cd338.e64d84","type":"debug","z":"cde7ed36.5f18c","name":"","active":true,"console":"false","complete":"false","x":440.5,"y":1385,"wires":[]}]
