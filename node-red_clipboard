[{"id":"dac07822.c9f688","type":"tab","label":"Flow 1"},{"id":"720256a3.564e98","type":"subflow","name":"Iterate","info":"","in":[{"x":220,"y":219,"wires":[{"id":"9a4c121e.5bdfe"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"9a4c121e.5bdfe","port":0}]},{"x":455,"y":259,"wires":[{"id":"9a4c121e.5bdfe","port":1}]}]},{"id":"99fe6992.bb4d28","type":"influxdb","z":"","hostname":"bd","port":"8086","protocol":"http","database":"mydb","name":"","usetls":false,"tls":""},{"id":"ad6fb2.e09f505","type":"influxdb","z":"","hostname":"bd","port":"8086","protocol":"http","database":"mydb","name":"","usetls":false,"tls":""},{"id":"9a4c121e.5bdfe","type":"function","z":"720256a3.564e98","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n //Make sure payload is an array\n if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n msg.payload = [msg.payload];\n }\n\n msg.iterationInfo = itt = {};\n itt.index = -1;\n itt.inArray = msg.payload;\n itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n nextObj = msg;\n msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n out = msg;\n msg.payload = itt.outArray;\n delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":341,"y":216,"wires":[[],[]]},{"id":"c150a2d7.a027f","type":"http request","z":"dac07822.c9f688","name":"show grafana sources","method":"GET","ret":"txt","url":"visualisation:3000/api/datasources","tls":"","x":391.0994110107422,"y":174.48009490966797,"wires":[["b11fb128.b89c8"]]},{"id":"b11fb128.b89c8","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"false","x":625.991096496582,"y":160.8888759613037,"wires":[]},{"id":"20fbed6c.d411a2","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":175.9939956665039,"y":182.43086528778076,"wires":[["c150a2d7.a027f"]]},{"id":"83f5964f.d78278","type":"http request","z":"dac07822.c9f688","name":"show grafana sources (second method)","method":"GET","ret":"txt","url":"172.17.0.1:32774/api/datasources","tls":"","x":439.5438766479492,"y":266.2020435333252,"wires":[["ef7b9705.b530c8"]]},{"id":"ef7b9705.b530c8","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"false","x":719.546688079834,"y":256.4996814727783,"wires":[]},{"id":"10a83669.37ad1a","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":178.88288116455078,"y":273.81948471069336,"wires":[["83f5964f.d78278"]]},{"id":"e04ec977.e11168","type":"http request","z":"dac07822.c9f688","name":"ping the database","method":"GET","ret":"txt","url":"bd:8086/ping","tls":"","x":386.8607711791992,"y":386.09596157073975,"wires":[["e6066da4.4229b","665010a0.66db5"]]},{"id":"f60b4741.a99968","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":185.0915412902832,"y":400.53282165527344,"wires":[["e04ec977.e11168"]]},{"id":"e6066da4.4229b","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"payload","x":597.3137245178223,"y":363.9737949371338,"wires":[]},{"id":"665010a0.66db5","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"headers","x":593.9803657531738,"y":410.75157928466797,"wires":[]},{"id":"84c9b1fe.f1811","type":"http request","z":"dac07822.c9f688","name":"create database","method":"POST","ret":"txt","url":"bd:8086/query","tls":"","x":592.9881935119629,"y":522.4569883346558,"wires":[["1f40dd44.2da5e3","5ba52b10.d1e684"]]},{"id":"3ffb63bb.4a111c","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":128.46910095214844,"y":545.1995544433594,"wires":[["45651208.9bc20c"]]},{"id":"1f40dd44.2da5e3","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"payload","x":800.6634941101074,"y":507.140513420105,"wires":[]},{"id":"5ba52b10.d1e684","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"headers","x":797.3300933837891,"y":552.8072156906128,"wires":[]},{"id":"45651208.9bc20c","type":"function","z":"dac07822.c9f688","name":"set parameters of the request","func":"msg.payload = {q:'CREATE DATABASE \"mydb\"'};\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":353.7610321044922,"y":536.7074708938599,"wires":[["84c9b1fe.f1811"]]},{"id":"da8c301a.19f86","type":"influxdb in","z":"dac07822.c9f688","influxdb":"ad6fb2.e09f505","name":"create db (method 2)","query":"CREATE DATABASE \"mydb2\"","x":397.32598876953125,"y":621.2996711730957,"wires":[["6c5f3bdf.b39f24","a256941c.6a1dc8"]]},{"id":"6c5f3bdf.b39f24","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"false","x":618.5830459594727,"y":606.6121702194214,"wires":[]},{"id":"a256941c.6a1dc8","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"headers","x":616.0759658813477,"y":656.6050910949707,"wires":[]},{"id":"90cc76c4.894218","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":168.57598876953125,"y":630.0851936340332,"wires":[["da8c301a.19f86"]]},{"id":"9dd93069.4f887","type":"influxdb in","z":"dac07822.c9f688","influxdb":"ad6fb2.e09f505","name":"show databases","query":"SHOW DATABASES","x":390,"y":734.54541015625,"wires":[["b7fe4422.f185e8","d7737775.22a408"]]},{"id":"b7fe4422.f185e8","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"false","x":631.2570571899414,"y":719.8579092025757,"wires":[]},{"id":"d7737775.22a408","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"headers","x":628.7499771118164,"y":769.850830078125,"wires":[]},{"id":"e95ab0ca.fe65d","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":181.25,"y":743.3309326171875,"wires":[["9dd93069.4f887"]]},{"id":"28d39e7.4db6962","type":"function","z":"dac07822.c9f688","name":"2messages","func":"var msg1 = { payload:\"CREATE DATABASE mydb5\" };\nvar msg2 = { payload:\"CREATE DATABASE mydb6\" };\nreturn [[msg1, msg2]];","outputs":1,"noerr":0,"x":250.7222137451172,"y":949.3610939979553,"wires":[["3ad99e64.955652"]]},{"id":"80f6e4cb.592958","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":113.61111450195312,"y":874.3055429458618,"wires":[["28d39e7.4db6962"]]},{"id":"e97128da.64c1b8","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"payload","x":710,"y":882,"wires":[]},{"id":"778d27a5.25d008","type":"influxdb in","z":"dac07822.c9f688","influxdb":"ad6fb2.e09f505","name":"create db (method 2)","query":"","x":540.3333358764648,"y":945.222246170044,"wires":[["e97128da.64c1b8"]]},{"id":"3ad99e64.955652","type":"function","z":"dac07822.c9f688","name":"set query","func":"msg.query=msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":392.2222328186035,"y":872.2222690582275,"wires":[["778d27a5.25d008"]]},{"id":"79c7c44c.01428c","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":123.33334350585938,"y":1115.5555438995361,"wires":[["befe4719.5c5a68"]]},{"id":"4e32b920.69b8d8","type":"split","z":"dac07822.c9f688","name":"","splt":"\\n","x":448.33335876464844,"y":1098.8888673782349,"wires":[["87cc6120.1b907"]]},{"id":"4b5efb12.4e70d4","type":"http request","z":"dac07822.c9f688","name":"","method":"GET","ret":"txt","url":"","tls":"","x":638.5,"y":1238,"wires":[["da6bba02.4e1838"]]},{"id":"87cc6120.1b907","type":"function","z":"dac07822.c9f688","name":"Get address","func":"var msg = { payload : msg.payload.address};\nreturn msg;","outputs":1,"noerr":0,"x":601.5,"y":1066,"wires":[["8e59bbf8.349328"]]},{"id":"1a4b8aba.07d8d5","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"url","x":795.5,"y":1130,"wires":[]},{"id":"8e59bbf8.349328","type":"function","z":"dac07822.c9f688","name":"Get URL","func":"msg.url = \"http://remote:remote@10.0.2.3/scada-remote?m=json&r=grp&fn=find&alias=\"+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":593.5,"y":1153,"wires":[["4b5efb12.4e70d4","1a4b8aba.07d8d5"]]},{"id":"befe4719.5c5a68","type":"http request","z":"dac07822.c9f688","name":"","method":"GET","ret":"txt","url":"http://remote:remote@10.0.2.3/scada-remote?m=json&r=objects","tls":"","x":293.5,"y":1124,"wires":[["4e32b920.69b8d8"]]},{"id":"da6bba02.4e1838","type":"file","z":"dac07822.c9f688","name":"","filename":"/home/data/test.txt","appendNewline":true,"createDir":false,"overwriteFile":"true","x":848.7500152587891,"y":1301.2500190734863,"wires":[]},{"id":"9d95203b.ed505","type":"function","z":"dac07822.c9f688","name":"inject json","func":"var msg = {payload:[\n {\n \"id\": 2308,\n \"address\": \"1/1/4\",\n \"data\": 176,\n \"datatype\": 14,\n \"date\": \"Sun, 25 Dec 2016 20:46:04 +0100\",\n \"comment\": \"\",\n \"name\": \"Puissance générale\",\n \"time\": 1482695164\n },\n {\n \"id\": 2309,\n \"address\": \"1/1/5\",\n \"data\": 1448061,\n \"datatype\": 14,\n \"date\": \"Sun, 25 Dec 2016 20:45:59 +0100\",\n \"comment\": \"\",\n \"name\": \"Energie générale\",\n \"time\": 1482695159\n }]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":289.3333435058594,"y":1330.3330078125,"wires":[["9c0b9e77.15116","3deb3055.3b306"]]},{"id":"6dc6663b.186638","type":"inject","z":"dac07822.c9f688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":127.5,"y":1325,"wires":[["9d95203b.ed505"]]},{"id":"9c0b9e77.15116","type":"file","z":"dac07822.c9f688","name":"","filename":"/home/data/test.txt","appendNewline":true,"createDir":false,"overwriteFile":"true","x":505.5,"y":1326,"wires":[]},{"id":"3deb3055.3b306","type":"debug","z":"dac07822.c9f688","name":"","active":true,"console":"false","complete":"false","x":440.5,"y":1385,"wires":[]}]
